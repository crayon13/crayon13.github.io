---
layout: post
title: "엘라스틱서치 실무 가이드"
category: books
tags: 개발
comments: true
---
## 개요
### 1. 검색 시스템 이해하기
#### 1.1 검색 시스템의 이해
##### 1.1.1 검색 시스템이란?
`검색 서비스 > 섬색 시스탬 > 검색 엔진`

엘라스틱서치는 검색엔진이다.
##### 1.1.2. 검색 시스템의 구성요소
- 스토리지
- 색인기
- 검색기

##### 1.1.3. 관계형 데이터베이스와의 차이점
- 구조와용어의 비교

엘라스틱서치 | 관계형 데이터베이스
-----| ----
인덱스 (Index) | 데이터베이스 (Database)
샤드 (Shard) | 파티션 (Partition)
타입 (Type) | 테이블 (Table)
문서 (Document) | 행 (Row) -> Record가 더 적당할 듯
필드 (Field) | 열 (Column)
매핑 (Mapping) | 스키마 (Schema)
Query DSL | SQL

- 추가, 검색, 삭제, 수정 기능 비교
    - 엘라스틱서치는 RESTful API를 사용

HTTP 메서드 | 기능 | 데이터베이스 질의 문법
----|----|---- 
GET | 데이터 조회 | SELECT
PUT | 데이터 생성 | INSERT
POST | 데이터 업데이트, 조회 | UPDATE, SELECT
DELETE | 데이터 삭제 | DELETE
HEAD | 인덱스의 정보 확인 | - 

- 엘라스틱서치 API 구조
```
curl -X (메서드) http://host:port/(인덱스)/(타입)/(문서 id) -d '{json 데이터}'
```
- DBMS와 비교해 보자
```
SELECT * FROM user WHERE name like '%가마돈%'

GET http://localhost:9200/user/_search?q=Name:가마돈
```
- 결과는 다음과 같이
```json
{
    "Id":1,
    "Name" : "가 마 돈", "Location": "서울", 
    "Gender" : "남",
    "Date":"2018-05-12"
}
```

#### 1.2 검색 시스템과 엘라스틱서치
##### 1.2.1 엘라시틱서치가 강력한 이유
- 오픈소스 검색엔진
- 전문 검색 (Full Text Search)
- 통계 분석
- 스키마리스 (Schemaless)
    - 데이터베이스는 스키마라는 구조에 따라 데이터를 적합한 형태로 변경해서 저장하고 관리한다.
    - 반면 엘라스틱서치는 정형화되지 않은 다양한 형태의 문서도 자동으로 색인하고 검색할 수 있다.
- RESTful API
- 멀티테넌시 (Multi-tenancy)
    - 서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러개의 인덱스를 한번에 조회 할 수 있다. 이를 이용해 멀티테넌시 기능을 제공할 수 있다.
- Document-Oriented
    - 여러 계증의 데이터를 JSON 형식의 구조화된 문서로 인덱스에 저장할 수 있다.
    계층 구조로 문서도 한번의 쿼리로 쉽게 조회 할 수 있다.
- 역색인 (Inverted Index)
    - 엘라스틱서치는 루씬기반으로 역색인을 지원한다.
    - 역색인이란 종이책의 마지막 페이지에서 제공하는 색인 페이지와 비슷하게 제공되는 특수한 데이터 구조다.
- 확장성과 가용성
##### 1.2.2 엘라스틱서치의 약점
- 실시간이 아니다.
    - 일반적으로 색인된 데이터는 통상적으로 1초 뒤에나 검색이 가능해 진다.
- 트랜잭션과 롤백 기능을 제공하지 않는다.
- 데이터의 업데이트를 제공하지 않는다.
    - 삭제, 생성의 과정을 거친다.
#### 1.3 실습 환경 구축
- 주요 설정

설정 | 설명
--- | ---
cluster.name | 클러스터..
node.name | 1개의 클러스터는 N개의 노드를 가질 수 있다.
path.data | 엘라스틱서치의 인덱스 경로를 지정한다. 설정하지 않으면 기본적으로 엘라스틱서치 하위의 data 디렉토리에 인덱스가 생성된다.
path.logs | 노드와 클러스터에서 생성되는 로그 경로 지정
path.repo | 인덱스를 백업하기 위한 스냅샷 경로를 지정
network.host | 특정 IP만 접근허용 0.0.0.0 은 전체 허용
http.port | 클라인트가 접근할 수 있는 http 포트 번호 - 기본 9200
transport.tcp.port | 클라인트가 접근할 수 있는 TCP 포트 - 기본 9300
discovery.zen.ping.unicast.hosts | 노드가 N개인 경우 유니캐스트로 활성화된 다른 서버를 찾는다. 클러스터로 묶인 노드(서버)의 IP를 지정하면 된다. 노드가 2개인 경우 `[1.1.1.1, 2.2.2.2]` 형태로 선언
discovery.zen.minimum_master_nodes | 마스터 노드의 선출 기준이 되는 노드의 수를 지정한다.
node.master | 마스터 노드로 동작 여부를 지정한다.
node.data | 데이터 노드로 동작 여부를 지정한다.


